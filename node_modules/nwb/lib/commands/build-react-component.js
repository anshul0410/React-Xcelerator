'use strict';

exports.__esModule = true;
exports.default = buildModule;

var _glob = require('glob');

var _glob2 = _interopRequireDefault(_glob);

var _moduleBuild = require('../moduleBuild');

var _moduleBuild2 = _interopRequireDefault(_moduleBuild);

var _buildDemo = require('./build-demo');

var _buildDemo2 = _interopRequireDefault(_buildDemo);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Create a React component's ES5 and ES6 modules and UMD builds and build its
 * demo app if it has one.
 */
function buildModule(args, cb) {
  var config = {
    babel: {
      presets: ['react']
    }
  };

  // Disable propTypes wrapping with --no-proptypes or --no-wrap-proptypes
  if (args.proptypes !== false && args['wrap-proptypes'] !== false) {
    // Wrap propTypes with an environment check
    config.babelDev = {
      plugins: [[require.resolve('babel-plugin-transform-react-remove-prop-types'), {
        mode: 'wrap'
      }]]
    };
    // Strip propTypes from UMD production build
    config.babelProd = {
      plugins: [require.resolve('babel-plugin-transform-react-remove-prop-types')]
    };
  }

  (0, _moduleBuild2.default)(args, config, function (err) {
    if (err) return cb(err);
    // Disable demo build with --no-demo or --no-demo-build
    if (args.demo === false || args['demo-build'] === false || _glob2.default.sync('demo/').length === 0) {
      return cb(null);
    }
    (0, _buildDemo2.default)(args, cb);
  });
}
module.exports = exports['default'];