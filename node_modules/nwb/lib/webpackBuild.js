'use strict';

exports.__esModule = true;
exports.default = webpackBuild;

var _webpack = require('webpack');

var _webpack2 = _interopRequireDefault(_webpack);

var _createWebpackConfig = require('./createWebpackConfig');

var _createWebpackConfig2 = _interopRequireDefault(_createWebpackConfig);

var _debug = require('./debug');

var _debug2 = _interopRequireDefault(_debug);

var _getPluginConfig = require('./getPluginConfig');

var _getPluginConfig2 = _interopRequireDefault(_getPluginConfig);

var _getUserConfig = require('./getUserConfig');

var _getUserConfig2 = _interopRequireDefault(_getUserConfig);

var _utils = require('./utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function webpackBuild(args) {
  var buildConfig = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];
  var cb = arguments[2];

  (0, _utils.defaultNodeEnv)('production');

  var userConfig = (0, _getUserConfig2.default)(args);
  var pluginConfig = (0, _getPluginConfig2.default)();
  if (typeof buildConfig == 'function') {
    buildConfig = buildConfig(args);
  }

  var webpackConfig = (0, _createWebpackConfig2.default)(buildConfig, pluginConfig, userConfig);

  (0, _debug2.default)('webpack config: %s', (0, _utils.deepToString)(webpackConfig));

  var compiler = (0, _webpack2.default)(webpackConfig);
  compiler.run(cb);
}
module.exports = exports['default'];